<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2do avance</title>
    <style>
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <!--<button type="button" id="button-login">Login</button>
    <button type="button" id="button-logout">Logout</button>-->
    <script type="module">
      import * as THREE from "./three.module.js";
      import { OrbitControls } from "./OrbitControls.js";
      import { GLTFLoader } from './GLTFLoader.js'; //para cargar modelos formato GLB

      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
      import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js"
      import { getDatabase, ref, set , onValue } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js"
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDAIB-zlORXvojGyx4clO-bGU8-yBE7JVI",
        authDomain: "coordenadas-a7e5d.firebaseapp.com",
        databaseURL: "https://coordenadas-a7e5d-default-rtdb.firebaseio.com",
        projectId: "coordenadas-a7e5d",
        storageBucket: "coordenadas-a7e5d.appspot.com",
        messagingSenderId: "19166009959",
        appId: "1:19166009959:web:51b35293af3a8f703952c2"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const provider = new GoogleAuthProvider();
      const auth = getAuth();
      const db = getDatabase();

      const buttonLogin = document.getElementById("button-login");
      const buttonLogout = document.getElementById("button-logout");

      const currentUser = {};


      //Login
      /*buttonLogin.addEventListener("click", async() =>{
        await signInWithPopup(auth, provider)
          .then((result) => {
            // This gives you a Google Access Token. You can use it to access the Google API.
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
            // The signed-in user info.
            currentUser  = result.user;
            console.log(currentUser);
            writeUserData(currentUser.uid, 0, 0)
            // IdP data available using getAdditionalUserInfo(result)
            // ...
          }).catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
          });
      })

      //Logout
      buttonLogout.addEventListener("click", async() =>{
        await signOut(auth).then(() => {
          // Sign-out successful.
          console.log('Sign-out successful');
        }).catch((error) => {
          // An error happened.
          console.log('un error ocurrio', error);
        });
      });

      //Leer Datos
      const starCountRef = ref(db, 'jugadores');
      onValue(starCountRef, (snapshot) => {
        const data = snapshot.val();
        Object.entries(data).forEach(([key,value]) =>{
          //console.log(`${key} ${value.x}  ${value.z}`);

          const jugador = scene.getObjectByName(key);

          //Si el jugador no existe se agrega a la escena
          if(!jugador){
            const loaderGLFT = new GLTFLoader();
            loaderGLFT.load("modelos/fhc_crying_child.glb", 
            function(modelGLFT){
              const obj = modelGLFT.scene;
              obj.scale.set(2.5, 2.5, 2.5);
              obj.position.set(value.x,-0.55,value.z);
              obj.name = key;
              scene.add(obj)
            });
          }
          else{
            scene.getObjectByName(key).position.x = value.x;
            scene.getObjectByName(key).position.z = value.z;
          }          
         
        })

        //console.log(data);
      });

      //Escribir Datos
      function writeUserData(userId, positionX, positionZ) {
        set(ref(db, 'jugadores/' + userId), {
          x: positionX,
          z: positionZ,
        });
      }
      */

      const scene = new THREE.Scene();
      scene.background = new THREE.Color("#566573");

      //MOVI LA CÁMARA PARA QUE ESTPE EN ÁNGULO CENITAL 
      const camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        1,
        100
      );
      camera.position.set(0, 25, 10); //y = 25

      const hemisphereLight = new THREE.HemisphereLight(0xffffbb, 0x080820, 1);
      scene.add(hemisphereLight);

      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const cameraControl = new OrbitControls(camera, renderer.domElement);

      function resize(){
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.render(scene,camera);
      }

      window.addEventListener("resize", resize);

      // Variables para el movimiento
      const movementSpeed = 0.1;
      const rotationSpeed = 0.05;
      const keys = {}; // Objeto para mantener el estado de las teclas
      let model;

      function loadModel(url, position) {
        const loader = new GLTFLoader();
        loader.load(url, (gltf) => {
          model = gltf.scene;
          model.position.copy(position);
          model.scale.set(2.5, 2.5, 2.5);
          scene.add(model);

          this._BB = new THREE.Box3();
                this._Mesh = this._Controls._target;
                this._BB.setFromObject(this._Controls._target);
                this._boxHelper = new THREE.Box3Helper( this._BB, 0xff0000 );
                this._boxHelper.updateMatrixWorld(true);
                this._Scene.add(this._boxHelper);

          if (url === "modelos/fhc_crying_child.glb") {
            camera.position.set(model.position.x, model.position.y + 30, model.position.z);
            camera.lookAt(model.position);
          }
        });
      }

      loadModel("modelos/fhc_crying_child.glb", new THREE.Vector3(0, -0.75, 0));


      function checkCollitions() {
        
        //cubo toca torus
        if (cube2BB.intersectsBox(torusBB)) {
          torus.material.color = new THREE.Color("orange");
          torus.material.wireframe = true;
        } else {
          torus.material.color = new THREE.Color("cyan");
          torus.material.wireframe = false;
        }
      }

      //Importar modelos

      //niño 1
      const loaderGLFT = new GLTFLoader();
      loaderGLFT.load("modelos/gregory.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(2.5, 2.5, 2.5);
        obj.position.set(-5,-0.55,1.5);
      
        scene.add(obj)

        

      });

      let gregory;

      //niño 2
      const ninio2 = new GLTFLoader();
      loaderGLFT.load("modelos/gregory.glb", 
      function(modelGLFT){
        gregory = modelGLFT.scene;
        gregory.scale.set(2.5, 2.5, 2.5);
        gregory.position.set(0, -0.75, 5);
      
        scene.add(gregory)
      });

      

      //suelo CAMPO FUTBOL
      // const canchaFut = new GLTFLoader();
      // loaderGLFT.load("modelos/football_field.glb", 
      // function(modelGLFT){
      //   const obj = modelGLFT.scene;
      //   obj.scale.set(1, 1, 1);
      //   obj.position.set(0, -3, 0);
      //   obj.rotation.set(0, 1.55, 0);
      
      //   scene.add(obj)
      // });

      //suelo Parque
      const parque = new GLTFLoader();
      loaderGLFT.load("modelos/city_park_at_sunset.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(1, 1, 1);
        obj.position.set(0, -1, 0);
        obj.rotation.set(0, 0, 0);
      
        scene.add(obj)
      });

      //caja madera
      const cajaMadera = new GLTFLoader();
      loaderGLFT.load("modelos/crate_box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.02, 0.02, 0.02);
        obj.position.set(10, -0.5, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cajaMadera2 = new GLTFLoader();
      loaderGLFT.load("modelos/crate_box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.02, 0.02, 0.02);
        obj.position.set(10, -0.5, 1.5);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cajaMadera3 = new GLTFLoader();
      loaderGLFT.load("modelos/crate_box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.02, 0.02, 0.02);
        obj.position.set(11.5, -0.5, 1.5);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //caja carton
      const cajaCarton = new GLTFLoader();
      loaderGLFT.load("modelos/box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(1, 1, 1);
        obj.position.set(-18, 0.5, -6);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cajaCarton2 = new GLTFLoader();
      loaderGLFT.load("modelos/box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(1, 1, 1);
        obj.position.set(-21, 0, -3);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cajaCarton3 = new GLTFLoader();
      loaderGLFT.load("modelos/box.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(1, 1, 1);
        obj.position.set(-18, 0, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      let balonObj;

      //balon
      const balon = new GLTFLoader();
      loaderGLFT.load("modelos/soccer_ball.glb", 
      function(modelGLFT){
        balonObj = modelGLFT.scene;
        balonObj.scale.set(0.55, 0.55, 0.55);
        balonObj.position.set(5, 0.5, 0);
      
        scene.add(balonObj);

        //caja colisión
        const box = new THREE.Box3().setFromObject(balonObj); 
        const boxHelper = new THREE.BoxHelper(balonObj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);

        animateBalon();
      });

      function animateBalon() {
        // Obtener el tiempo transcurrido desde el inicio de la animación
        const tiempo = Date.now() * 0.001;

        // Definir la velocidad de rotación en radianes por segundo
        const velocidadRotacion = 1;

        // Calcular la rotación en cada eje
        const rotX = Math.sin(tiempo * velocidadRotacion) * Math.PI * 0.25;
        const rotY = Math.cos(tiempo * velocidadRotacion) * Math.PI * 0.25;

        // Aplicar la rotación al objeto del balón
        balonObj.rotation.set(rotX, rotY, 0);

        // Solicitar al navegador que actualice la animación en el próximo cuadro
        requestAnimationFrame(animateBalon);
      }

      //carro oxidado
      const carroMalo = new GLTFLoader();
      loaderGLFT.load("modelos/old_car_wreck.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.06, 0.06, 0.06);
        obj.position.set(-6, -1.25, 10);
        obj.rotation.set(0, 80, 0); //rotaciones
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const carroMalo2 = new GLTFLoader();
      loaderGLFT.load("modelos/old_car_wreck.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.06, 0.06, 0.06);
        obj.position.set(6, -1.25, -15);
        obj.rotation.set(0, 0, 0); //rotaciones
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //Carro que parece camioneta
      const carroCamioneta = new GLTFLoader();
      loaderGLFT.load("modelos/old_car_-_vaz_2107.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.025, 0.025, 0.025);
        obj.position.set(15, -0.5, -12);
        obj.rotation.set(0, 0, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //carro policia
      const carroPoli = new GLTFLoader();
      loaderGLFT.load("modelos/police_car.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(2, 2, 2);
        obj.position.set(20, -0.5, 8);
        obj.rotation.set(0, 80, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //cono trafico
      const cono = new GLTFLoader();
      loaderGLFT.load("modelos/traffic_cone.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(2, 2, 2);
        obj.position.set(0, -0.85, 10);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cono2 = new GLTFLoader();
      loaderGLFT.load("modelos/traffic_cone.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(3, 3, 3);
        obj.position.set(-5, -0.55, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cono3 = new GLTFLoader();
      loaderGLFT.load("modelos/traffic_cone.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(3, 3, 3);
        obj.position.set(-5, -0.45, -1.5);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const cono4 = new GLTFLoader();
      loaderGLFT.load("modelos/traffic_cone.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(3, 3, 3);
        obj.position.set(-5, -0.4, -3);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //Chango
      const chango = new GLTFLoader();
      loaderGLFT.load("modelos/cymbal_monkey.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.03, 0.03, 0.03);
        obj.position.set(10, 0, -8);
        obj.rotation.set(5, 0, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //rayo
      const rayo = new GLTFLoader();
      loaderGLFT.load("modelos/lightning_bolt.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.2, 0.2, 0.2);
        obj.position.set(-15, 0, -2);
        obj.rotation.set(-8, 0, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //puntos dobles
      const dobles = new GLTFLoader();
      loaderGLFT.load("modelos/double_points_pickup.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(10, 10, 10);
        obj.position.set(2.5, 0, 8);
        obj.rotation.set(-8, 0, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //banca de parque
      const banca = new GLTFLoader();
      loaderGLFT.load("modelos/park_bench.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.03, 0.03, 0.03);
        obj.position.set(0, -0.8, -12);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const banca2 = new GLTFLoader();
      loaderGLFT.load("modelos/park_bench.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.03, 0.03, 0.03);
        obj.position.set(-10, -0.8, 4.5);
        obj.rotation.set(0, 3.15, 0);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //Policia
      const policia = new GLTFLoader();
      loaderGLFT.load("modelos/15_bob_police_m_05.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(4, 4, 4);
        obj.position.set(7, -0.5, -3);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //Arbol
      const arbol = new GLTFLoader();
      loaderGLFT.load("modelos/cartoon_tree.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(2, 2, 2);
        obj.position.set(-10, 0, -10);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      const arbol2 = new GLTFLoader();
      loaderGLFT.load("modelos/cartoon_tree.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(2, 2, 2);
        obj.position.set(10, 0, 10);
      
        scene.add(obj)

        const box = new THREE.Box3().setFromObject(obj); //calcular caja de colisión
        const boxHelper = new THREE.BoxHelper(obj, 0xff0000); //ver caja de colisión
        scene.add(boxHelper);
      });

      //abuela
      const abue = new GLTFLoader();
      loaderGLFT.load("modelos/stylized_grandma.glb", 
      function(modelGLFT){
        const obj = modelGLFT.scene;
        obj.scale.set(0.7, 0.7, 0.7);
        obj.position.set(-10, 0, -8);
      
        scene.add(obj)
      });

    const loaderGLTF = new GLTFLoader();
    loaderGLTF.load("gregory_1983_crying_child_model_edit.glb", 
    function(modeloGLTF){
      console.log(modeloGLTF);
      const obj = modeloGLTF.scene;
      obj.scale.set(2, 2, 2);
      obj.position.set(2.5, -0.55, 1.5);
      scene.add(obj)

      const animationClips = modeloGLTF.animations;
      if (animationClips.length >= 7) {
          const segundaAnimacion = animationClips[6]; // La segunda animación
          const mixer = new THREE.AnimationMixer(obj);
          const action = mixer.clipAction(segundaAnimacion);
          action.play();

          let lastTime = 0;
          
          // Actualiza el mixer
          function update(time) {
              const delta = time - lastTime;
              lastTime = time;
              mixer.update(delta / 1000); // Convertir a segundos
          }

          renderer.setAnimationLoop((time) => {
              update(time);
              renderer.render(scene, camera);
          });
      } else {
          console.error("El modelo no tiene suficientes animaciones.");
      }
    });

    let chloe;

    const chava = new GLTFLoader();
      loaderGLFT.load("chloe_price_-_life_is_strange.glb", 
      function(modelGLFT){
        console.log(modelGLFT);
        chloe = modelGLFT.scene;
        chloe.scale.set(2, 2, 2);
        chloe.position.set(-5, 0, -8);
      
        scene.add(chloe);

        const animationClips = modelGLFT.animations;
        if (animationClips.length >= 1) {
            const segundaAnimacion = animationClips[0]; // La segunda animación
            const mixer = new THREE.AnimationMixer(chloe);
            const action = mixer.clipAction(segundaAnimacion);
            action.play();

            let lastTime = 0;
            
            // Actualiza el mixer
            function update(time) {
                const delta = time - lastTime;
                lastTime = time;
                mixer.update(delta / 1000); // Convertir a segundos
            }

            renderer.setAnimationLoop((time) => {
                update(time);
                renderer.render(scene, camera);
            });
        } else {
            console.error("El modelo no tiene suficientes animaciones.");
        }
      });

    /*
    const policiaChido = new GLTFLoader();
    loaderGLTF.load("modelosAnimaciones/policeman_-_low_poly_character_with_animation.glb", 
    function(modeloGLTF){
      console.log(modeloGLTF);
      const obj = modeloGLTF.scene;
      obj.scale.set(2, 2, 2);
      obj.position.set(-2.5, -0.55, -1.5);
      scene.add(obj)

      // Busca la segunda animación
      const animationClips = modeloGLTF.animations;
      if (animationClips.length >= 2) {
          const segundaAnimacion = animationClips[1]; // La segunda animación
          const mixer = new THREE.AnimationMixer(obj);
          const action = mixer.clipAction(segundaAnimacion);
          action.play();

          // Actualiza el mixer
          function update() {
              mixer.update(0.01);
          }

          renderer.setAnimationLoop(() => {
              update();
              renderer.render(scene, camera);
          });
      } else {
          console.error("El modelo no tiene suficientes animaciones.");
      }
    });

    */

    const perrito = new GLTFLoader();
    loaderGLTF.load("modelosAnimaciones/animated_dog_shiba_inu.glb", 
    function(modeloGLTF){
      console.log(modeloGLTF);
      const obj = modeloGLTF.scene;
      obj.scale.set(.025, .025, .025);
      obj.position.set(8, -0.55,8);
      scene.add(obj)

      // Busca la segunda animación
      const animationClips = modeloGLTF.animations;
      if (animationClips.length >= 2) {
          const segundaAnimacion = animationClips[1]; // La segunda animación
          const mixer = new THREE.AnimationMixer(obj);
          const action = mixer.clipAction(segundaAnimacion);
          action.play();

          let lastTime = 0;
          
          // Actualiza el mixer
          function update(time) {
              const delta = time - lastTime;
              lastTime = time;
              mixer.update(delta / 1000); // Convertir a segundos
          }

          renderer.setAnimationLoop((time) => {
              update(time);
              renderer.render(scene, camera);
          });
      } else {
          console.error("El modelo no tiene suficientes animaciones.");
      }
    });

    /*

    document.onkeydown = function (e) {
      const jugadorActual = scene.getObjectByName(currentUser.uid);
      console.log(e.keyCode);

      //Tecla W
      if(e.keyCode == 87){
        jugadorActual.position.x = jugadorActual.position.x - 1;
      }
      //Tecla S
      if(e.keyCode == 83){
        jugadorActual.position.x = jugadorActual.position.x + 1;
      }
      //Tecla A
      if(e.keyCode == 65){
        jugadorActual.position.z = jugadorActual.position.z - 1;
      }
      //Tecla D
      if(e.keyCode == 68){
        jugadorActual.position.z = jugadorActual.position.z + 1;
      }

      writeUserData(
        currentUser.uid,
        jugadorActual.position.x, 
        jugadorActual.position.z 
      );
    }

    */

      // const rabbit = new GLTFLoader();
      // loaderGLFT.load("cute_rabbit_model.glb", 
      // function(modelGLFT){
      //   const obj = modelGLFT.scene;
      //   obj.scale.set(0.08, 0.08, 0.08);
      //   obj.position.set(0, 0, 2.5);
      
      //   scene.add(obj)
      // });

      function handleMovement() {
        // Actualizar estado de las teclas presionadas
        window.addEventListener("keydown", (event) => {
          keys[event.key] = true;
        });
        window.addEventListener("keyup", (event) => {
          keys[event.key] = false;
        });

        // Actualizar posición de jugador según las teclas presionadas
        if (model) {
          if (keys["ArrowUp"]) model.position.z -= movementSpeed;
          if (keys["ArrowDown"]) model.position.z += movementSpeed;
          if (keys["ArrowLeft"]) model.position.x -= movementSpeed;
          if (keys["ArrowRight"]) model.position.x += movementSpeed;

          if(model){
            camera.position.set(model.position.x, model.position.y + 30, model.position.z);
            camera.lookAt(model.position);
          }

          if (gregory) { // Reemplaza 'otroModelo' con el nombre de tu segundo modelo
            if (keys["w"]) gregory.position.z -= movementSpeed; // Por ejemplo, para mover hacia adelante con la tecla 'w'
            if (keys["s"]) gregory.position.z += movementSpeed; // Para mover hacia atrás con la tecla 's'
            if (keys["a"]) gregory.position.x -= movementSpeed; // Para mover hacia la izquierda con la tecla 'a'
            if (keys["d"]) gregory.position.x += movementSpeed; // Para mover hacia la derecha con la tecla 'd'
          }

        };
      }

      function animate() {
        requestAnimationFrame(animate);

        handleMovement();
        //Función para detectar colisiones
        //Dentro de animate para comprobar en todo momento si hay colisión
        //checkCollitions();
         box.setFromObject(obj); //actualizar caja si el modelo se mueve o cambia tamaño
         boxHelper.update();

         if(this._BB && this._Mesh && (this._IsMainPlayer == true)){
                this._BB.setFromObject(this._Mesh);
            }

        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>
